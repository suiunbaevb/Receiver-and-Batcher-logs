# Log Processing Pipeline

–î–≤–µ Spring Boot-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏—ë–º–∞ XML, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è ¬´—Å—ã—Ä—ã—Ö¬ª –ª–æ–≥–æ–≤ –∏ –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –ø–µ—Ä–µ–Ω–æ—Å–∞ –∑–∞–ø–∏—Å–µ–π:

1. **log-receiver**
   HTTP‚Äë—Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É **9091**, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç XML, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ JSON –∏ –ø–∏—à–µ—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥ `logs/`
   –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞: `<Type>-YYYY-MM-DD.log`, –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî —Å—á—ë—Ç—á–∏–∫ –∑–∞–ø–∏—Å–µ–π, –¥–∞–ª–µ–µ ‚Äî JSON‚Äë—Å—Ç—Ä–æ–∫–∏.

2. **log-batcher**
   CLI‚Äë—É—Ç–∏–ª–∏—Ç–∞, —á–∏—Ç–∞—é—â–∞—è `logs/*.log`, –±–µ—Ä—ë—Ç –∑–∞–ø–∏—Å–∏ –ø–∞—á–∫–∞–º–∏ –ø–æ 100 –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤
   `<Type>-YYYY-MM-DD-0001.log`, `<Type>-YYYY-MM-DD-0002.log`‚Ä¶
   –•—Ä–∞–Ω–∏—Ç —Ñ–∞–π–ª `batch.offset` —Å —á–∏—Å–ª–æ–º —É–∂–µ —É–ø–∞–∫–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å –º–µ—Å—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```text
log-project/                ‚Üê parent POM
‚îú‚îÄ‚îÄ log-receiver/           ‚Üê –ø—Ä–∏—ë–º–Ω–∏–∫ XML
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ pom.xml
‚îú‚îÄ‚îÄ log-batcher/            ‚Üê –ø–∞–∫–µ—Ç–∏—Ä–æ–≤—â–∏–∫ –ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ pom.xml
‚îî‚îÄ‚îÄ pom.xml                 ‚Üê parent module
```

---

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Java 21 (–∏–ª–∏ –Ω–æ–≤–µ–µ)
* Maven 3.8+
* (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Docker, Docker Compose

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í –∫–∞–∂–¥–æ–º –º–æ–¥—É–ª–µ –≤ `src/main/resources/application.yml`:

```yaml
log-dir: ../logs     # –æ–±—â–∏–π –∫–∞—Ç–∞–ª–æ–≥ –ª–æ–≥–æ–≤ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π)
```

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è **log-receiver**:

```yaml
server:
  port: 9091
```

–ò –¥–ª—è **log-batcher**:

```yaml
batch:
  size: 100   # —Ä–∞–∑–º–µ—Ä –ø–∞—á–∫–∏, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100
```

–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:

```bash
export LOG_DIR=/var/app/logs
export BATCH_SIZE=200
export SERVER_PORT=8080   # –¥–ª—è log-receiver
```

---

## üöÄ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

–ò–∑ –∫–æ—Ä–Ω—è `log-project`:

```bash
# –°–±–æ—Ä–∫–∞ –æ–±–æ–∏—Ö –º–æ–¥—É–ª–µ–π\mvn clean package
```

### 1. –ó–∞–ø—É—Å–∫ log-receiver

```bash
mvn -pl log-receiver spring-boot:run
```

* –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç `http://localhost:9091/`
* –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ XML (Postman, curl):

  ```bash
  curl -X POST http://127.0.0.1:9091/ \
       -H "Content-Type: application/xml" \
       --data @sample.xml
  ```
* –í –∫–∞—Ç–∞–ª–æ–≥–µ `logs/` –ø–æ—è–≤–∏—Ç—Å—è —Ñ–∞–π–ª `Information-YYYY-MM-DD.log`

### 2. –ó–∞–ø—É—Å–∫ log-batcher

```bash
mvn -pl log-batcher spring-boot:run
```

* –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–π–¥—ë—Ç –≤—Å–µ `*.log` –≤ `logs/`, –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É (—Å—á—ë—Ç—á–∏–∫)
* –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã `*-0001.log`, `*-0002.log`‚Ä¶ –ø–æ `batch.size` –∑–∞–ø–∏—Å–µ–π
* –û–±–Ω–æ–≤–∏—Ç `logs/batch.offset`

---


---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ (End-to-End)

1. –ó–∞–ø—É—Å—Ç–∏–ª–∏ `log-receiver` ‚Üí –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ 5 XML ‚Üí –ø–æ–ª—É—á–∏–ª–∏
   `Information-YYYY-MM-DD.log` —Å 5 –∑–∞–ø–∏—Å—è–º–∏.
2. –ó–∞–ø—É—Å—Ç–∏–ª–∏ `log-batcher` ‚Üí –≤ `logs/` –ø–æ—è–≤–∏–ª–∏—Å—å
   `Information-YYYY-MM-DD-0001.log` –∏ `batch.offset=5`.
3. –î–æ–±–∞–≤—å—Ç–µ –µ—â—ë >100 –∑–∞–ø–∏—Å–µ–π –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—è–≤—è—Ç—Å—è `-0002.log`.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**log-receiver**:

* MockMvc-—Ç–µ—Å—Ç: –æ—Ç–ø—Ä–∞–≤–∫–∞ XML, –ø—Ä–æ–≤–µ—Ä–∫–∞ HTTP 200 –∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —Å—á—ë—Ç—á–∏–∫–æ–º –∏ JSON-–∑–∞–ø–∏—Å—å—é.

**log-batcher**:

* JUnit5 —Ç–µ—Å—Ç —Å `@TempDir`: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ `Information-YYYY-MM-DD.log` —Å 150 —Å—Ç—Ä–æ–∫, –∑–∞–ø—É—Å–∫ `BatchProcessor`, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è 15 —Ñ–∞–π–ª–æ–≤ –ø–æ 10 —Å—Ç—Ä–æ–∫ –∏ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ `batch.offset=150`.

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
mvn test
```

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Äî –ø–∏—à–∏—Ç–µ –Ω–∞ [email@example.com](mailto:email@example.com)
GitHub: [https://github.com/username/log-project](https://github.com/username/log-project)
